---
repos:
  # Markdown formatting
    - repo: https://github.com/executablebooks/mdformat
      rev: 0.7.17
      hooks:
          - id: mdformat
            additional_dependencies:
                - mdformat-gfm
                - mdformat-tables
            exclude: ^(\.venv/|uv\.lock)

  # Python formatting and linting
    - repo: https://github.com/astral-sh/ruff-pre-commit
      rev: v0.1.15
      hooks:
          - id: ruff
            args: [--fix, --exit-non-zero-on-fix]
            exclude: ^(\.venv/|uv\.lock)
          - id: ruff-format
            exclude: ^(\.venv/|uv\.lock)

  # Type checking
    - repo: https://github.com/pre-commit/mirrors-mypy
      rev: v1.8.0
      hooks:
          - id: mypy
            additional_dependencies: []
            args: [--ignore-missing-imports]
            exclude: ^(\.venv/|uv\.lock)

    # Security scanning
    - repo: https://github.com/PyCQA/bandit
      rev: 1.7.6
      hooks:
          - id: bandit
            args: [-f, json]
            exclude: ^(tests/|\.venv/|uv\.lock)

  # General file checks
    - repo: https://github.com/pre-commit/pre-commit-hooks
      rev: v4.5.0
      hooks:
          - id: trailing-whitespace
          - id: end-of-file-fixer
          - id: check-yaml
            exclude: ^(\.venv/|uv\.lock)
          - id: check-toml
            exclude: ^(\.venv/|uv\.lock)
          - id: check-json
            exclude: ^(\.venv/|uv\.lock)
          - id: check-added-large-files
            args: [--maxkb=1000]
          - id: check-merge-conflict
          - id: check-case-conflict
          - id: detect-private-key

  # YAML formatting
    - repo: https://github.com/jumanjihouse/pre-commit-hook-yamlfmt
      rev: 0.2.1
      hooks:
          - id: yamlfmt
            exclude: ^(\.venv/|uv\.lock)

  # TOML formatting
    - repo: https://github.com/ComPWA/taplo-pre-commit
      rev: v0.9.3
      hooks:
          - id: taplo-format
            exclude: ^(\.venv/|uv\.lock)

  # Python-specific checks
    - repo: https://github.com/pre-commit/pygrep-hooks
      rev: v1.10.0
      hooks:
          - id: python-check-blanket-noqa
          - id: python-check-mock-methods
          - id: python-no-eval
          - id: python-no-log-warn

    # Run tests on pre-push
    - repo: local
      hooks:
          - id: pytest
            name: pytest
            entry: bash -c 'uv run pytest || [ $? -eq 5 ]'
            language: system
            pass_filenames: false
            always_run: true
            stages: [pre-push]
